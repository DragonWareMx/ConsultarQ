extends ../main

block head
    title ConsultarQ - Roles
    link(rel="stylesheet" href="/stylesheets/others.css")
block content
    div(class="uk-container")
        div(class="uk-flex uk-flex-between uk-margin-top uk-flex-middle uk-flex-wrap")
            div(class="uk-text-left   uk-text-large   uk-text-bold uk-text-primary uk-margin-bottom") Administrar Roles
            div(class="uk-animation-toggle uk-margin-bottom" tabindex="0")
                a(class="uk-text-right uk-flex-inline uk-flex uk-flex-middle uk-text-primary uk-link-heading uk-animation-shake" href="/roles/nuevo")
                    img(src="/icons/more.png" style="width:20px;height:20px;margin-top:3px" class="uk-margin-small-right")
                    div Agregar rol
        div(class="uk-child-width-1-2@s" uk-grid)
            each role in roles
                div
                    div(class="uk-card uk-card-default uk-width-1 uk-padding-small")
                        div(class="uk-card-body uk-flex uk-padding-remove")
                            div(class="uk-animation-toggle uk-width-1 uk-text-right uk-margin-auto-left uk-margin-remove-right" tabindex="0")
                                a(class="uk-text-right uk-flex-inline uk-flex-middle uk-flex uk-text-primary uk-link-heading uk-animation-shake" href="#")
                                    img(src="/icons/edit.png" style="width:10px;height:10px" class="uk-margin-small-right")
                                    div(class="uk-text-small") Editar
                        div(class="uk-flex uk-flex-middle uk-flex-wrap")
                            div(class="uk-text-large uk-margin-small-right") #{role.name}
                            div(class="uk-right uk-margin-small-top") #{role.Permissions.length} permisos
                        div() #{role.Users.length} usuarios tienen asignado este rol
                        div(class="uk-flex uk-flex-wrap")
                            div(class="uk-width-1 uk-flex uk-flex-middle uk-flex-wrap" style="height:44px")
                                each user , index in role.Users
                                    if user.picture
                                        img(src="/uploads/avatar/"+user.picture uk-tooltip=user.Employee.name style="width:34px;height:34px;background-size:cover;object-fit:cover;" class="uk-border-circle uk-margin-small-right uk-margin-small-top")
                                    else
                                        img(src="/img/iconos/default.png" uk-tooltip=user.Employee.name style="width:34px;height:34px;background-size:cover;object-fit:cover;" class="uk-border-circle uk-margin-small-right uk-margin-small-top")
                                    if index == 4
                                        - break
                                if role.Users.length > 5
                                    div(class="uk-right uk-margin-top") #{role.Users.length - 5} más...
                        div(class="uk-overflow-auto uk-margin-top")
                            table(class="uk-table uk-table-small uk-table-divider")
                                thead
                                    tr
                                        th(class="uk-table-spand uk-table-shrink@m") Permisos
                                        th(class="uk-table-shrink") Crear
                                        th(class="uk-table-shrink") Lectura
                                        th(class="uk-table-shrink") Edición
                                        th(class="uk-table-shrink") Eliminar
                                -
                                    var list = { "uc":"No","ur":"No","uu":"No","ud":"No",
                                                    "cc":"No","cr":"No","cu":"No","cd":"No",
                                                    "sc":"No","sr":"No","su":"No","sd":"No",
                                                    "pc":"No","pr":"No","pu":"No","pd":"No",
                                                    "dc":"No","dr":"No","du":"No","dd":"No",
                                                    "ec":"No","er":"No","eu":"No","ed":"No"
                                                    };
                                each perm in role.Permissions
                                    if (perm.name == "uc")
                                        - list.uc="Si"
                                    else if (perm.name == "ur")
                                        - list.ur="Si"
                                    else if (perm.name == "uu")
                                        - list.uu="Si"
                                    else if (perm.name == "ud")
                                        - list.ud="Si"
                                    else if (perm.name == "cc")
                                        - list.cc="Si"
                                    else if (perm.name == "cr")
                                        - list.cr="Si"
                                    else if (perm.name == "cu")
                                        - list.cu="Si"
                                    else if (perm.name == "cd")
                                        - list.cd="Si"
                                    else if (perm.name == "sc")
                                        - list.sc="Si"
                                    else if (perm.name == "sr")
                                        - list.sr="Si"
                                    else if (perm.name == "su")
                                        - list.su="Si"
                                    else if (perm.name == "sd")
                                        - list.sd="Si"
                                    else if (perm.name == "pc")
                                        - list.pc="Si"
                                    else if (perm.name == "pr")
                                        - list.pr="Si"
                                    else if (perm.name == "pu")
                                        - list.pu="Si"
                                    else if (perm.name == "pd")
                                        - list.pd="Si"
                                    else if (perm.name == "dc")
                                        - list.dc="Si"
                                    else if (perm.name == "dr")
                                        - list.dr="Si"
                                    else if (perm.name == "du")
                                        - list.du="Si"
                                    else if (perm.name == "dd")
                                        - list.dd="Si"
                                    else if (perm.name == "ec")
                                        - list.ec="Si"
                                    else if (perm.name == "er")
                                        - list.er="Si"
                                    else if (perm.name == "eu")
                                        - list.eu="Si"
                                    else if (perm.name == "ed")
                                        - list.ed="Si"
                                tbody
                                    tr
                                        td Usuarios
                                        td(class="uk-text-center")
                                            div()
                                                = list.uc
                                        td(class="uk-text-center")
                                            div()
                                                = list.ur
                                        td(class="uk-text-center")
                                            div()
                                                = list.uu
                                        td(class="uk-text-center")
                                            div()
                                                = list.ud
                                    tr
                                        td Caja chica
                                        td(class="uk-text-center")
                                            div()
                                                = list.cc
                                        td(class="uk-text-center")
                                            div()
                                                = list.cr
                                        td(class="uk-text-center")
                                            div()
                                                = list.cu
                                        td(class="uk-text-center")
                                            div()
                                                = list.cd
                                    tr
                                        td Cartera de servicios
                                        td(class="uk-text-center")
                                            div()
                                                = list.sc
                                        td(class="uk-text-center")
                                            div()
                                                = list.sr
                                        td(class="uk-text-center")
                                            div()
                                                = list.su
                                        td(class="uk-text-center")
                                            div()
                                                = list.sd
                                    tr
                                        td Proyectos
                                        td(class="uk-text-center")
                                            div()
                                                = list.pc
                                        td(class="uk-text-center")
                                            div()
                                                = list.pr
                                        td(class="uk-text-center")
                                            div()
                                                = list.pu
                                        td(class="uk-text-center")
                                            div()
                                                = list.pd
                                    tr
                                        td Directorio de clientes
                                        td(class="uk-text-center")
                                            div()
                                                = list.dc
                                        td(class="uk-text-center")
                                            div()
                                                = list.dr
                                        td(class="uk-text-center")
                                            div()
                                                = list.du
                                        td(class="uk-text-center")
                                            div()
                                                = list.dd
                                    tr
                                        td Prestadores externos
                                        td(class="uk-text-center")
                                            div()
                                                = list.ec
                                        td(class="uk-text-center")
                                            div()
                                                = list.er
                                        td(class="uk-text-center")
                                            div()
                                                = list.eu
                                        td(class="uk-text-center")
                                            div()
                                                = list.ed

    script.
        $(document).ready(function(){
             var users=!{ JSON.stringify(roles) };
             console.log(users);
        })