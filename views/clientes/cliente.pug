extends ../main

block head
    title ConsultarQ - Cliente
    link(rel="stylesheet" href="/stylesheets/others.css")
    link(rel="stylesheet" href="/stylesheets/clientes.css")
block content
    div(class="uk-container")
        div(class="uk-flex uk-flex-between uk-margin-top uk-flex-middle uk-flex-wrap")
            div(class="uk-text-left uk-text-large uk-text-bold uk-text-primary uk-margin-bottom") Cliente
            div(class="uk-animation-toggle uk-margin-bottom" tabindex="0")
                a(href="javascript:history.back(-1);" class="uk-text-right uk-flex-inline uk-flex uk-flex-middle uk-link-muted uk-link-heading uk-animation-shake" style="color:#6B6B72 !important")
                    img(src="/icons/netGray.png" style="width:20px;height:20px;margin-top:3px" class="uk-margin-small-right")
                    div Regresar
        -function prettyDate(dateString){
                //if it's already a date object and not a string you don't need this line:
                -var date = new Date(dateString);
                -var d = date.getDate();
                -var monthNames = [ "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio","Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre" ];
                -var m = monthNames[date.getMonth()];
                -var y = date.getFullYear();
                -return d+' '+m+' '+y;
        -}
        //- tarjeta del cliente
        div(class="uk-grid-match uk-margin-top uk-flex" uk-grid )
            div(class="uk-width-1-1@m" style="height:min-content")
                div.uk-card.uk-card-default.uk-card-body.uk-padding-remove
                    div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-padding-small
                        div(class="uk-width-auto@m")
                            img(src="/img/iconos/default.png" style="width:70px; height:70px; border-radius:50px; margin-right:15px")
                        div(class="uk-width-expand@m" style="font-size:14px")
                            div.uk-flex.uk-width-1-1.uk-flex-wrap-reverse
                                div(class="uk-width-auto@l" style="color:#222238; font-size:16px; font-weight:400") #{client.name}
                                div(class="uk-width-expand@l uk-text-right")
                                    a.uk-flex-inline.uk-flex-middle(style="text-decoration:none; color:#1e87f0 !important" href="#modal-editarCliente" uk-toggle)
                                        img(src="/icons/edit.png" style="width:10px;height:10px" class="uk-margin-small-right")
                                        div(class="uk-text-small") Editar
                            div.uk-width-1-1.uk-flex.uk-flex-middle(uk-tooltip="title: Teléfono; pos: left" style="margin-top:3px")
                                <span uk-icon="icon:receiver; ratio: 0.8" style="margin-right:5px"></span> #{client.phone_number}
                            div.uk-width-1-1.uk-flex.uk-flex-middle(style="word-break: break-all; margin-top:3px"  uk-tooltip="title: Correo electrónico; pos: left")
                                <span uk-icon="icon:mail; ratio: 0.8" style="margin-right:5px"></span> #{client.email}
                            div.uk-width-1-1.uk-flex.uk-flex-middle(style="margin-top:3px" uk-tooltip="title: Fecha de registro; pos: left")
                                <span uk-icon="icon:calendar; ratio: 0.8" style="margin-right:5px"></span> #{prettyDate(client.createdAt)}
                            div.uk-width-1-1.uk-flex.uk-flex-middle(style="margin-top:3px" uk-tooltip="title: Área; pos: left")
                                <span uk-icon="icon:thumbnails; ratio: 0.8" style="margin-right:5px"></span> #{client.Client_Area.name}
                            div.uk-width-1-1.uk-flex.uk-flex-middle(style="margin-top:3px" uk-tooltip="title: RFC; pos: left")
                                <span uk-icon="icon:hashtag; ratio: 0.8" style="margin-right:5px"></span> #{client.rfc}
                            div.uk-width-1-1.uk-flex.uk-flex-middle(style="margin-top:3px" uk-tooltip="title: Estatus; pos: left")
                                if client.status === "active"
                                    div(class="uk-width-4-5@m btn-status-active") ACTIVO
                                else 
                                    div(class="uk-width-4-5@m btn-status-active btn-status-noactive") INACTIVO

                    //- cotizaciones
                    div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-padding-small.uk-flex-middle(style="border-top: solid 1px #C7C7C7") 
                        div.uk-width-1-1.uk-flex-inline.uk-flex-wrap.uk-flex-middle
                            div(class="uk-width-1-5@m uk-text-truncate") Cotización
                            div(class="uk-width-4-5@m uk-text-emphasis uk-flex-inline uk-flex-middle uk-flex-wrap" style="font-size:14px") 
                                div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-flex-middle
                                    a.uk-link-reset(href="#") Nombre de la cotización.PDF<span uk-icon="icon:file-pdf; ratio: 0.6" style="margin-left:3px"></span>
                                    div(style="font-size:12px; color:#666666 !important") &nbsp;&nbsp;Proyecto 47
                                div#MoreCot
                                    div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-flex-middle
                                        a.uk-link-reset(href="#") Nombre de la cotización.PDF<span uk-icon="icon:file-pdf; ratio: 0.6" style="margin-left:3px"></span>
                                        div(style="font-size:12px; color:#666666 !important") &nbsp;&nbsp;Proyecto 47
                                div.uk-width-1-1.uk-flex.uk-flex-middle#GenerarCot
                                    a.uk-flex.uk-flex-middle(href="/clientes/generar-cotizacion" style="width:max-content")
                                        <span uk-icon="icon:file-pdf; ratio: 0.8" style="margin-right:5px"></span>Generar
                        div.uk-width-1-1.uk-flex.uk-flex-right.uk-margin-small-top
                            a.uk-flex.uk-flex-middle(href="#" style="font-size:13px" id="a-MoreCot") 
                                img(src="/icons/eye.png" style="width:15px;height:15px; margin-right:5px") 
                                |Ver más 

                    //- contratos        
                    div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-padding-small.uk-flex-middle(style="border-top: solid 1px #C7C7C7") 
                        div.uk-width-1-1.uk-flex-inline.uk-flex-wrap.uk-flex-middle
                            div(class="uk-width-1-5@m uk-text-truncate") Contratos
                            div(class="uk-width-4-5@m uk-text-emphasis uk-flex-inline uk-flex-middle uk-flex-wrap" style="font-size:14px")
                                
                                div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-flex-middle
                                    a.uk-link-reset(href="#") Nombre del contrato.PDF<span uk-icon="icon:file-pdf; ratio: 0.6" style="margin-left:3px"></span>
                                    div(style="font-size:12px; color:#666666 !important") &nbsp;&nbsp;Proyecto 47
                                div#MoreCont
                                    div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-flex-middle
                                        a.uk-link-reset(href="#") Nombre del contrato.PDF<span uk-icon="icon:file-pdf; ratio: 0.6" style="margin-left:3px"></span>
                                        div(style="font-size:12px; color:#666666 !important") &nbsp;&nbsp;Proyecto 100
                                //- boton agregar contrato
                                div.uk-width-1-1.uk-flex.uk-flex-middle#GenerarCont
                                    a.uk-flex.uk-flex-middle(href="#modal-adjuntarContrato" uk-toggle style="width:max-content")
                                        <span uk-icon="icon:upload; ratio: 0.8" style="margin-right:5px"></span>Adjuntar contrato
                        div.uk-width-1-1.uk-flex.uk-flex-right.uk-margin-small-top
                            a.uk-flex.uk-flex-middle(href="#" style="font-size:13px" id="a-MoreCont") 
                                img(src="/icons/eye.png" style="width:15px;height:15px; margin-right:5px") 
                                |Ver más

            //- tarjetas de proyectos
            div(class="uk-text-left uk-text-large uk-text-bold uk-text-primary") Proyectos
            //- si no hay ningun proyecto debe mostrarse un mensaje
            if client.Projects
                each project in client.Projects
                    div(class="uk-width-1-1@m uk-flex")
                        div.uk-card.uk-card-default.uk-card-body.uk-padding-remove.uk-margin-bottom
                            div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-padding-small(style="font-size:14px")
                                div.uk-width-1-1 Proyecto #{project.id}
                                div.uk-width-1-1.uk-text-truncate.uk-text-emphasis 
                                    a.uk-link-reset(href="#") #{project.name}
                                div.uk-width-1-1
                                    progress(id="js-progressbar" class="uk-progress uk-margin-remove" value="40" max="100")
                                div.uk-width-1-1.uk-text-right.uk-text-emphasis(style="font-size:14px") Progreso 40%
                                div.uk-width-1-1 Estatus
                                div.uk-width-1-1.uk-flex.uk-flex-middle
                                    if project.status === "ACTIVO" || project.status === "TERMINADO"
                                        div(class="uk-width-4-5@m btn-status-active") #{project.status}
                                    else 
                                        div(class="uk-width-4-5@m btn-status-active btn-status-noactive") #{project.status}
                                div.uk-width-1-1 Tipo
                                if (project.Pro_Type && project.Pro_Type.name)
                                    div.uk-width-1-1.uk-text-truncate.uk-text-emphasis #{project.Pro_Type.name}
                                else
                                    div.uk-width-1-1.uk-text-truncate.uk-text-emphasis No tiene
                                div.uk-width-1-1 Fecha de inicio
                                div.uk-width-1-1.uk-text-truncate.uk-text-emphasis #{prettyDate(project.start_date)}
                                div.uk-width-1-1 Fecha de término
                                div.uk-width-1-1.uk-text-truncate.uk-text-emphasis #{prettyDate(project.deadline)}
                                div.uk-width-1-1 Miembros del proyecto
                                div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-margin-small-top
                                    each user,index in project.Users
                                        if user.picture
                                            img(src="/uploads/avatar/"+user.picture uk-tooltip='title: '+ user.Employee.name +'; pos:left' style="width:30px; height:30px; border-radius:50px; margin-bottom:5px; margin-right:5px" )
                                        else
                                            img(src="/img/iconos/default.png" uk-tooltip='title: '+ user.Employee.name +'; pos:left' style="width:30px; height:30px; border-radius:50px; margin-bottom:5px; margin-right:5px" )
                                        if index == 4
                                            - break
                                    if project.Users.length > 5
                                        div(class="uk-right uk-margin-top") #{project.Users.length - 5} más...
                                        //-img(uk-tooltip="title: Nombre completo; pos: left" src="/img/iconos/default.png" style="width:30px; height:30px; border-radius:50px; margin-bottom:5px; margin-right:5px")
            else
                div(class="uk-width-1-1@m uk-flex")
                    div.uk-card.uk-card-default.uk-card-body.uk-padding-remove.uk-margin-bottom
                        div.uk-width-1-1.uk-flex.uk-flex-wrap.uk-padding-small(style="font-size:14px")
                            | No se tienen proyectos registrados

    div(id="modal-adjuntarContrato" uk-modal)
        div(class="uk-modal-dialog uk-modal-body")
            div(class="uk-text-left  uk-text-large uk-text-bold uk-text-primary") Adjuntar contrato
            div(style="border: dashed #c7c7c7 1px" class="uk-flex uk-flex-middle uk-padding uk-margin")
                a(id="archivo" class="uk-flex uk-flex-center uk-flex-middle uk-width-1 uk-flex-wrap")
                    <span uk-icon="icon: upload; ratio: 0.8" style="margin-right:5px"></span>Selecciona el archivo
                input(name="fileField" type="file" id="fileField" style="visibility:hidden;height:2px;width:30px")
            div(class="uk-width-1 uk-flex-right uk-flex")
                button(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize uk-modal-close" type="button" ) Cancelar
                button(class="uk-button uk-button-primary uk-border-rounded uk-text-capitalize" id="btnEnviar" type="submit") Agregar
    
    //- modal editar
    div(id="modal-editarCliente" uk-modal)
        div(class="uk-modal-dialog uk-modal-body")
            div(class="uk-text-left  uk-text-large uk-text-bold uk-text-primary") Editar cliente
            div.width-1-1.uk-margin-top
                form(class="uk-card-body uk-padding-remove uk-padding-remove-bottom" id="form-edit-cliente" action=""  method="POST" enctype="multipart/form-data")
                    div(class="uk-text-left uk-margin-remove uk-text-primary") FOTO DE PERFIL
                        div(class="form-group uk-border-circle")
                            img(src="/img/iconos/default.png" alt=""  id="avatar-edit" class="uk-border-circle uk-margin-auto uk-flex" style="width:100px;height:100px; background-size:cover; object-fit:cover;")
                            a(id="foto-edit" class="uk-flex uk-flex-center uk-flex-middle uk-margin-auto uk-width-1 uk-flex-wrap" style="width:max-content; font-size:13px")
                                <span uk-icon="icon: pencil; ratio: 0.8" style="margin-right:5px"></span>Editar foto
                            input(name="fileField" type="file" id="fileField-edit" style="visibility:hidden;height:2px;width:30px")
                    div(class="uk-text-left uk-text-primary uk-margin-small-bottom") DATOS GENERALES
                    .field.uk-margin-bottom
                        input(type='text' autocomplete='on' id="name_edit" name="name_edit" value=client.name onchange="this.setAttribute('value', this.value);" required='')
                        label(for='name_edit' title='Nombre Completo' data-title='Nombre Completo')
                    .field.uk-margin-bottom
                        input(type='text' autocomplete='on' id="email_edit" name="email_edit" value=client.email onchange="this.setAttribute('value', this.value);" required='')
                        label(for='email_edit' title='Correo electrónico' data-title='Correo electrónico')
                    .field.uk-margin-bottom
                        input(type='text' autocomplete='tel' id="phone_edit" name="phone_edit" value=client.phone_number onchange="this.setAttribute('value', this.value);" required='')
                        label(for='phone_edit' title='Número telefónico' data-title='Número telefónico')
                    .field.uk-margin-bottom
                        input(type='text' autocomplete='rfc' id="rfc_edit" name="rfc_edit" value=client.rfc onchange="this.setAttribute('value', this.value);" required='')
                        label(for='rfc_edit' title='RFC' data-title='RFC')
                    div.uk-grid
                        div(class="uk-width-1-2@s uk-width-1-1")
                            .field.uk-margin-bottom
                                select(id="area_edit" name="area_edit" autocomplete='off' value='' required)
                                    each area in client.Client_Area
                                        option(value=area.id) #{area.name}
                                label(for='area_edit' title='Área' data-title='Área')
                        div(class="uk-width-1-2@s uk-width-1-1")
                            .field.uk-margin-bottom
                                select(id="status_edit" name="status_edit" autocomplete='off' value='' required)
                                    option(value="active") Activo
                                    option(value="inactive") Inactivo
                                label(for='status_edit' title='Estatus' data-title='Estatus')
                    div(class="uk-alert-danger uk-margin-remove" uk-alert style="display:none" id="status-alert")
                        p(class="uk-text-small") Si el estatus del cliente es inactivo, no podrá ser asignado a nuevos proyectos.
                    a(class="uk-flex uk-flex-middle uk-text-danger uk-link-heading uk-margin-small-top" id="btnEliminar" href="#delete-form" uk-toggle)
                        <span uk-icon="icon: trash; ratio: 0.8" style="margin-right:5px"></span>Eliminar
                    div(class="uk-width-1 uk-flex-right uk-flex")
                        button(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize uk-modal-close" type="button" ) Cancelar
                        button(class="uk-button uk-button-primary uk-border-rounded uk-text-capitalize" id="btnEnviar" type="submit") Guardar
    
    //- modal eliminar
    div(id="delete-form" uk-modal)
            div(class="uk-modal-dialog uk-modal-body")
                div(class="uk-text-left  uk-text-large uk-text-bold uk-text-danger") Eliminar usuario
                button(type='button' uk-close='' class="uk-modal-close-default")
                div(id="errors-delete")
                div(class="uk-text-left" id="text-delete") ¿Estás seguro de que deseas eliminar al cliente Dragonware?
                form(class="uk-card-body uk-padding-small" id="form-delete-user" action=""  method="POST")
                    div(class="uk-width-1 uk-flex-right uk-flex uk-flex-middle")
                        a(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize" href="#modal-editarCliente" uk-toggle data-id="" data-name="") Cancelar
                        button(class="uk-button uk-button-danger uk-border-rounded uk-text-capitalize" id="btnEnviar-delete" type="submit") Eliminar
    
    
    script.
        jQuery(($) => {
            $('#a-MoreCot').on('click', function() {
                 if ($("#MoreCot").is(':visible')) {
                    $("#MoreCot").hide();
                    $("#GenerarCot").hide();
                    $("#a-MoreCot").html("<img src='/icons/eye.png' style='width:15px;height:15px; margin-right:5px'> Ver más")
                }
                else{
                    $("#MoreCot").show();
                    $("#GenerarCot").show();
                    $("#a-MoreCot").html("<img src='/icons/notEye.png' style='width:15px;height:15px; margin-right:5px'> Ver menos")
                }
            });

            $('#a-MoreCont').on('click', function() {
                 if ($("#MoreCont").is(':visible')) {
                    $("#MoreCont").hide();
                    $("#GenerarCont").hide();
                    $("#a-MoreCont").html("<img src='/icons/eye.png' style='width:15px;height:15px; margin-right:5px'> Ver más")
                }
                else{
                    $("#MoreCont").show();
                    $("#GenerarCont").show();
                    $("#a-MoreCont").html("<img src='/icons/notEye.png' style='width:15px;height:15px; margin-right:5px'> Ver menos")
                }
            });

            $('#status').on('change', function(){
                if( $('#status').val() == 'active'){
                    $('#status-alert').hide();
                }
                else{
                    $('#status-alert').show();
                }
            });
        });            

                        
                    
        