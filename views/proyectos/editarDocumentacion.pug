extends ../main

block head
    title ConsultarQ - Proyectos Documentación
    link(rel="stylesheet" href="/stylesheets/others.css")
block content
    div(class="uk-container")
        div(class="uk-flex uk-flex-between uk-margin-top uk-flex-middle uk-flex-wrap")
            div(class="uk-text-left   uk-text-large   uk-text-bold uk-text-primary uk-margin-bottom") Editar documentación de proyecto
            div(class="uk-animation-toggle uk-margin-bottom" tabindex="0")
                a(href="/proyectos/documentacion" class="uk-text-right uk-flex-inline uk-flex uk-flex-middle uk-text-muted uk-link-heading uk-animation-shake uk-animation-fast")
                    img(src="/img/iconos/netGray.png" style="width:20px;height:20px;margin-top:2px;" class="uk-margin-small-right")
                    div Regresar
        div(class="uk-grid-small uk-child-width-1 uk-grid-row-large uk-margin-top" uk-grid)
            div(class="uk-card uk-card-default uk-card-body uk-padding-remove-bottom uk-margin-small-bottom")
                div(class="uk-flex uk-flex-top uk-flex-between")
                    div(class="uk-text-primary uk-margin-bottom uk-margin-small-left") #{project.name}
                    div(class="uk-flex uk-flex-middle")
                        a.uk-margin-small-right(href="#" uk-toggle="target: #editDocument-form")
                            <span uk-icon="pencil"></span>
                        a.uk-margin-small-left(href="#" uk-toggle="target: #deleteDocument-form" style="color:#DC5454")
                            <span uk-icon="trash"></span>
                        //- img(src="/icons/edit.png" uk-toggle="target: #editDocument-form" width="13px" class="uk-margin-small-right" style="cursor:pointer")
                        //- img(src="/icons/delete.png" uk-toggle="target: #deleteDocument-form" width="13px" class="uk-margin-small-left" style="cursor:pointer")
                div(class="uk-overflow-auto")
                    table(class="uk-table uk-table-small uk-table-divider uk-table-justify")
                        thead
                            tr
                                th(class="uk-text-center uk-table-shrink") #
                                th(class="uk-text-truncate uk-table-expand") Concepto
                                th(class="uk-text-truncate uk-table-expand") Descripción
                                th(class="uk-text-truncate uk-width-small") Cantidad
                                th(class="uk-text-truncate uk-width-small") Unidad
                                th(class="uk-text-truncate  uk-width-small") Costo/U
                                th(class="uk-text-truncate uk-width-small") Costo/T
                                th(class="uk-text-truncate uk-width-small") Realizado
                        tbody
                            each task, index in project.Tasks
                                tr(uk-toggle="target: #editTask-form" class="editar" data-id=task.id) 
                                    td #{index + 1}
                                    td #{task.concept} 
                                    td #{task.description} 
                                    td #{task.units} 
                                    td #{task.unit} 
                                    td #{task.price}
                                    td #{task.price*task.units} 
                                    if task.check
                                        td Sí 
                                    else
                                        td No
                div(class="uk-flex uk-flex-right  uk-flex-middle uk-width-1 uk-margin-top uk-margin-small-bottom")
                    img(src="/icons/more.png" width="20px" style="margin-top:3px; margin-right:5px;")
                    a(uk-toggle="target: #task-form") Agregar Tarea
            div(class="uk-card uk-card-default uk-card-body uk-padding-remove uk-margin-small-top uk-flex uk-flex-wrap")
                div(class="uk-margin-small-top uk-margin-small-left uk-text-small uk-width-1") OBSERVACIONES
                div(class="uk-width-1 uk-text-secondary" style="border:1px solid #C7C7C7;border-radius:2px;font-size:13px;line-height:16px;margin:19px;padding:8px;") #{project.observations} 
        //- Modal para editar tarea
        div(id="editTask-form" uk-modal)
            div(class="uk-modal-dialog uk-modal-body")
                div(class="uk-flex uk-flex-between")
                    div(class="uk-text-left  uk-text-large uk-text-bold uk-text-primary") Editar tarea
                    div(class="uk-flex uk-flex-middle" uk-toggle="target: #deleteTask-form")
                        img(src="/icons/delete.png" width="12px")
                        a(class="uk-text-danger uk-text-small uk-margin-small-left") Eliminar
                button(type='button' uk-close='' class="uk-modal-close-default")
                div(id="errors-editTask")
                form(class="uk-card-body uk-padding-small" id="form-edit-task" action="" method="POST" enctype="multipart/form-data")
                    div(class="uk-child-width-1 uk-grid")
                        div
                            .field.uk-margin-bottom
                                input(type='text' autocomplete='off' id="concepto-edit" name="concepto" value='' onchange="this.setAttribute('value', this.value);" required='')
                                label(for='concepto-edit' title='Concepto' data-title='Concepto')
                            .field.uk-margin-bottom
                                input(type='text' autocomplete='off' id="descripcion-edit" name="descripcion" value='' onchange="this.setAttribute('value', this.value);" required='')
                                label(for='descripcion-edit' title='Descripcion' data-title='Descripcion')
                        div
                            div.uk-grid
                                div(class="uk-width-1-2@s uk-width-1-1")
                                    .field.uk-margin-bottom
                                        input(type='number' autocomplete='off'  id="cantidad-edit" name="cantidad"  value='' onchange="this.setAttribute('value', this.value);" required='')
                                        label(for='cantidad-edit' title='Cantidad' data-title='Cantidad')
                                div(class="uk-width-1-2@s uk-width-1-1")
                                    .field.uk-margin-bottom
                                        input(type='text' autocomplete='off'  id="unidad-edit" name="unidad"  value='' onchange="this.setAttribute('value', this.value);" required='')
                                        label(for='unidad-edit' title='Unidad' data-title='Unidad')
                                div(class="uk-width-1-2@s uk-width-1-1")
                                    .field.uk-margin-bottom
                                        input(type='number' autocomplete='off'  id="costo-edit" name="costo"  value='' onchange="this.setAttribute('value', this.value);")
                                        label(for='costo-edit' title='Costo' data-title='Costo')
                                div(class="uk-width-1-2@s uk-width-1-1 uk-flex uk-flex-top uk-flex-right")
                                    input(type='checkbox' autocomplete='off'  id="realizado-edit" name="realizado" onchange="this.setAttribute('value', this.value);" style="margin-top:5px")
                                    label(for='realizado-edit' class="uk-text-primary") Realizado
                        div(class="uk-flex uk-flex-right@s uk-flex-center uk-margin-top")
                            button(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize uk-modal-close" type="button" ) Cancelar
                            button(class="uk-button uk-button-primary uk-border-rounded uk-text-capitalize" id="editTask" type="submit") Guardar
        //- Modal para eliminar tarea 
        div(id="deleteTask-form" uk-modal)
            div(class="uk-modal-dialog uk-modal-body")
                div(class="uk-text-left  uk-text-large uk-text-bold uk-text-danger") Eliminar tarea
                button(type='button' uk-close='' class="uk-modal-close-default")
                div(id="errors-deleteTask")
                div(class="uk-text-left" id="textTask-delete") ¿Estás seguro de que deseas eliminar la tarea?
                form(class="uk-card-body uk-padding-small" id="form-delete-task" action=""  method="POST")
                    div(class="uk-width-1 uk-flex-right uk-flex uk-flex-middle")
                        button(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize uk-modal-close" type="button" ) Cancelar
                        button(class="uk-button uk-button-danger uk-border-rounded uk-text-capitalize" id="deleteTask" type="submit") Eliminar
        //- Modal para eliminar documentacion
        div(id="deleteDocument-form" uk-modal)
            div(class="uk-modal-dialog uk-modal-body")
                div(class="uk-text-left  uk-text-large uk-text-bold uk-text-danger") Eliminar documentacion
                button(type='button' uk-close='' class="uk-modal-close-default")
                div(id="errors-deleteDocument")
                div(class="uk-text-left" id="textDocument-delete") ¿Estás seguro de que deseas eliminar la documentación del proyecto "#{project.name}"?
                form(class="uk-card-body uk-padding-small" id="form-delete-document" action="/proyectos/documentacion/"+project.id+"/eliminar"  method="POST")
                    div(class="uk-width-1 uk-flex-right uk-flex uk-flex-middle")
                        button(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize uk-modal-close" type="button" ) Cancelar
                        button(class="uk-button uk-button-danger uk-border-rounded uk-text-capitalize" id="deleteDocument" type="submit") Eliminar
        //- Modal para agregar tarea
        div(id="task-form" uk-modal)
            div(class="uk-modal-dialog uk-modal-body")
                div(class="uk-text-left  uk-text-large uk-text-bold uk-text-primary") Agregar tarea
                button(type='button' uk-close='' class="uk-modal-close-default")
                div(id="errors-task")
                form(class="uk-card-body uk-padding-small" id="form-new-task" action="/proyectos/documentacion/"+project.id+"/tarea/agregar" method="POST" enctype="multipart/form-data")
                    div(class="uk-child-width-1 uk-grid")
                        div
                            .field.uk-margin-bottom
                                input(type='text' autocomplete='off' id="concepto" name="concepto" value='' onchange="this.setAttribute('value', this.value);" required='')
                                label(for='concepto' title='Concepto' data-title='Concepto')
                            .field.uk-margin-bottom
                                input(type='text' autocomplete='off' id="descripcion" name="descripcion" value='' onchange="this.setAttribute('value', this.value);" required='')
                                label(for='descripcion' title='Descripcion' data-title='Descripcion')
                        div
                            div.uk-grid
                                div(class="uk-width-1-2@s uk-width-1-1")
                                    .field.uk-margin-bottom
                                        input(type='number' autocomplete='off'  id="cantidad" name="cantidad"  value='' onchange="this.setAttribute('value', this.value);" required='')
                                        label(for='cantidad' title='Cantidad' data-title='Cantidad')
                                div(class="uk-width-1-2@s uk-width-1-1")
                                    .field.uk-margin-bottom
                                        input(type='text' autocomplete='off'  id="unidad" name="unidad"  value='' onchange="this.setAttribute('value', this.value);" required='')
                                        label(for='unidad' title='Unidad' data-title='Unidad')
                                div(class="uk-width-1-2@s uk-width-1-1")
                                    .field.uk-margin-bottom
                                        input(type='number' autocomplete='off'  id="costo" name="costo"  value='' onchange="this.setAttribute('value', this.value);")
                                        label(for='costo' title='Costo' data-title='Costo')
                                div(class="uk-width-1-2@s uk-width-1-1 uk-flex uk-flex-top uk-flex-right")
                                    input(type='checkbox' autocomplete='off'  id="realizado" name="realizado" onchange="this.setAttribute('value', this.value);" style="margin-top:5px")
                                    label(for='realizado' class="uk-text-primary") Realizado
                        div(class="uk-flex uk-flex-right@s uk-flex-center uk-margin-top")
                            button(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize uk-modal-close" type="button" ) Cancelar
                            button(class="uk-button uk-button-primary uk-border-rounded uk-text-capitalize" id="task" type="submit") Agregar
        //- Modal para editar documentacion
        div(id="editDocument-form" uk-modal)
            div(class="uk-modal-dialog uk-modal-body")
                div(class="uk-text-left  uk-text-large uk-text-bold uk-text-primary") Editar documentación
                button(type='button' uk-close='' class="uk-modal-close-default")
                div(id="errors-editDocument")
                form(class="uk-card-body uk-padding-small" id="form-edit-document" action="/proyectos/documentacion/"+project.id+"/editar" method="POST" enctype="multipart/form-data")
                    div(class="uk-child-width-1 uk-grid")
                        div
                            .field.uk-margin-bottom
                                input(type='text' autocomplete='off' id="titulo-edit" name="titulo" value=project.name onchange="this.setAttribute('value', this.value);" required='')
                                label(for='titulo-edit' title='Tipo de proyecto' data-title='Tipo de proyecto')
                            .field.uk-margin-bottom
                                input(type='text' autocomplete='off' id="observaciones-edit" name="observaciones" value=project.observations onchange="this.setAttribute('value', this.value);" )
                                label(for='observaciones-edit' title='Observaciones' data-title='Observaciones')
                        div(class="uk-flex uk-flex-right@s uk-flex-center uk-margin-top")
                            button(class="uk-button uk-button-text uk-margin-medium-right uk-text-primary uk-text-capitalize uk-modal-close" type="button" ) Cancelar
                            button(class="uk-button uk-button-primary uk-border-rounded uk-text-capitalize" id="document-edit" type="submit") Guardar
    script.
        $('.editar').on('click', function() {
            var taskId = $(this).data('id'); 
            var tasks=!{ JSON.stringify(project.Tasks) };
            var project=!{ JSON.stringify(project) };
            for(var key in tasks){
                var obj=tasks[key];
                if(obj["id"] == taskId){
                    break;
                }
            }
            //Aqui empieza a llenarse el modal
            $('#concepto-edit').val(obj["concept"]).change();
            $('#descripcion-edit').val(obj["description"]).change();
            $('#unidad-edit').val(obj["unit"]).change();
            $('#cantidad-edit').val(obj["units"]).change();
            $('#costo-edit').val(obj["price"]).change();
            if(obj["check"])
                $('#realizado-edit').attr('checked', true)
            else 
                $('#realizado-edit').attr('checked', false)
            //esto es para poner el id en el action del form
            $('#form-edit-task').attr('action', '/proyectos/documentacion/'+project["id"]+'/tarea/editar/'+obj["id"]);
            $('#form-delete-task').attr('action', '/proyectos/documentacion/'+project["id"]+'/tarea/eliminar/'+obj["id"]);
        });                               