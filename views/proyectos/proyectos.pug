extends ../main

block head
    title ConsultarQ - Proyectos
    link(rel="stylesheet" href="/stylesheets/others.css")
    link(rel="stylesheet" href="/stylesheets/oProgressBar.css")
    link(rel="stylesheet" href="/stylesheets/oProyectMenu.css")
block content
    div(class="uk-container")
        div(class="uk-flex uk-flex-between uk-margin-top uk-flex-middle uk-flex-wrap")
            div(class="uk-text-left   uk-text-large   uk-text-bold uk-text-primary uk-margin-bottom") Proyectos
            div(class="uk-flex uk-flex-between uk-flex-wrap uk-width-1-2@m uk-width-1 uk-margin-small-bottom uk-text-small o-proyect-menu-hide")
                a(href="/proyectos/documentacion" class="uk-padding-small uk-padding-remove-vertical" style="color: #6B6B72; text-decoration:none;") DOCUMENTACIÓN
                a(href="/proyectos/activos" class="uk-padding-small uk-padding-remove-vertical" style="color: #6B6B72; text-decoration:none; border-bottom: 2px solid #3B86D9; padding-bottom:7px;") ACTIVOS
                a(href="/proyectos/inactivos" class="uk-padding-small uk-padding-remove-vertical" style="color: #6B6B72; text-decoration:none;") INACTIVOS
            div(class="uk-animation-toggle uk-margin-bottom" tabindex="0")
                a(class="uk-text-right uk-flex-inline uk-flex uk-flex-middle uk-text-primary uk-link-heading uk-animation-shake")
                    img(src="/icons/more.png" style="width:20px;height:20px;margin-top:3px" class="uk-margin-small-right")
                    div Agregar proyecto
        form(class="uk-flex uk-margin-bottom")
            div(class="uk-search uk-search-default uk-width-expand")
                button(href="#" uk-search-icon)
                input(class="uk-search-input" type="search" placeholder="Buscar...")
                input(class="uk-search-input" type="hidden" name="filter" id="filter" value="name" placeholder="Buscar...")
            //- boton de filtrar
            button(class="uk-button uk-button-primary uk-width-auto" href="#" type="button")
                img(src="/icons/filterWhite.png" style="width:20px;height:20px;" class="")
            div(uk-dropdown="mode: click")
                ul(class="uk-list")
                    li(onclick="putSearch('name')") Nombre
                    li(onclick="putSearch('tipo')") Tipo
                    li(onclick="putSearch('miembro')") Miembro
        div(class="o-proyect-menu-show uk-width-1")
                a(href="/proyectos/documentacion" class="" ) DOC
                a(href="/proyectos/activos" class="o-menu-selected") ACTIVOS
                a(href="/proyectos/inactivos" class="") INACTIVOS
                div(class="uk-animation-toggle uk-margin-bottom" tabindex="0")
        div(class="uk-grid-small uk-child-width-1-3@m uk-child-width-1-2@s uk-grid-row-large" uk-grid)
            //- PROYECTO
            each proyecto in proyectos
                div()
                    div(class="uk-card  uk-card-default")
                        //- NOMBRE, TIPO DE PROYECTO Y ESTATUS
                        div(class="uk-card-header uk-padding-remove uk-flex" style="background:rgba(190, 59, 192, 0.53);")
                            div(class="uk-width-3-5 uk-margin-small-left uk-margin-small-top uk-margin-small-bottom")
                                div(class="" style="color: #222238;") #{proyecto.name}
                                if proyecto.Pro_Type
                                    div(class="uk-text-small" style="height: 20.8px") #{proyecto.Pro_Type.name}
                                else
                                    div(class="uk-text-small" style="height: 20.8px") 
                            div(class="uk-width-2-5 uk-flex uk-flex-right uk-flex-middle")
                                if proyecto.status == 'ATRASADO'
                                    button(class="uk-margin-small-right" style="background:#F1A5A5;border-radius:2px;color:#DC5454;border:none;padding:7px;font-size:8px;") ATRASADO
                                else if proyecto.status == 'EN TIEMPO' || proyecto.status == 'ACTIVO'
                                    button(class="uk-margin-small-right" style="background: #86DDAE;border-radius:2px;color: #129326;border:none;padding:7px;font-size:8px;" /* CAMBIA EL COLOR DEL TEXTO Y BACKGROUND*/) #{proyecto.status}
                        //- FECHAS
                        div(class="uk-card-body uk-padding-remove")
                            div(class="uk-width-1 uk-margin-small-top")
                                div(class="o-progress-date-line")
                                div(class="o-progress-date-start" style="background:#BE3BC0;")
                                div(class="o-progress-date-end" style="background:#BE3BC0;")
                                -
                                    const fechaII = new Date(proyecto.start_date+"T11:22:33+0000")
                                    const fechaI = fechaII.getTime()
                                    const fechaTI = new Date(proyecto.deadline+"T11:22:33+0000")
                                    const fechaT = fechaTI.getTime()
                                    const hoyI = new Date()
                                    const hoy = hoyI.getTime()

                                    var diasF
                                    diasF = ((hoy-fechaI)/(fechaT-fechaI))*100

                                    if(diasF > 91)
                                        diasF = 91
                                    else if(diasF < 5)
                                        diasF = 5

                                    const MESES = [
                                    "ENE",
                                    "FEB",
                                    "MAR",
                                    "ABR",
                                    "MAY",
                                    "JUN",
                                    "JUL",
                                    "AGO",
                                    "SEP",
                                    "OCT",
                                    "NOV",
                                    "DIC",
                                    ];
                                    const f = new Date();

                                    mesI = MESES[fechaII.getMonth()];
                                    mesF = MESES[fechaTI.getMonth()];
                                div(class="o-progress-date-today" uk-tooltip=hoyI.getDate()+"/"+(hoyI.getMonth()+1)+"/"+hoyI.getFullYear() style="margin-left:"+diasF+"%; border: 1px solid #BE3BC0;" /*Aquí en el margin va el valor del avance, calcularlo de alguna forma, pero no debe pasar de 93% ni ser menos de 5%*/)
                                div(class="o-progress-date-dates")
                                    div(class="uk-text-small") #{fechaII.getDate()}, #{mesI}, #{fechaII.getFullYear()}
                                    div(class="uk-text-small") #{fechaTI.getDate()}, #{mesF}, #{fechaTI.getFullYear()}
                        //- AVANCES TAREAS
                        div(class="uk-width-1 uk-flex uk-flex-wrap uk-margin-small-top")
                            div(class="uk-width-2-5")
                                div(class="progress--circle progress--95" style="")
                                    div(class="progress__number") 93%
                            div(class="uk-width-3-5 uk-width-1@s uk-width-3-5")
                                div(class="uk-text-large" style="color: #222238;") 22
                                div(class="uk-text-small") Tareas listas
                                div(class="uk-text-large" style="color: #222238;") 15
                                div(class="uk-text-small") Tareas faltantes
                        //- MIEMBROS DEL PROYECTO
                        div(class="uk-margin-top uk-margin-small-left uk-text-small") MIEMBROS DEL PROYECTO
                        div(class="uk-width-1 uk-flex uk-flex-wrap")
                            div(class="uk-width-2-3 uk-flex uk-flex-wrap uk-margin-bottom")
                                each user , index in proyecto.Users
                                    if user.picture
                                        img(src="/uploads/avatar/"+user.picture uk-tooltip=user.Employee.name width="33px" class="uk-margin-small-left" style="border-radius:50%; height:33px;object-fit:cover;margin-top:10px;")
                                    else
                                        img(src="/img/iconos/default.png" width="33px" uk-tooltip=user.Employee.name class="uk-margin-small-left" style="border-radius:50%; height:33px;object-fit:cover;margin-top:10px;")
                                    if index == 4
                                        - break
                                if proyecto.Users.length > 5
                                    div(class="uk-right uk-margin-top") #{role.Users.length - 5} más...
                            //- ARCHIVOS Y COMENTARIOS
                            div(class="uk-width-1-3 uk-position-bottom-right uk-flex uk-flex-right uk-flex-middle uk-margin-small-right uk-margin-bottom")
                                img(src="/icons/archivo.png" width="13px" style="margin-right:5px;" uk-tooltip="archivos")
                                -
                                    var contadorArchivos
                                    if(proyecto.contract)
                                        contadorArchivos = 1
                                    else
                                        contadorArchivos = 0
                                if proyecto.Quotations
                                    each quotation in proyecto.Quotations
                                        -
                                            contadorArchivos++
                                div(class="uk-text-small" style="margin-right:10px; cursor: default") #{contadorArchivos}
                                img(src="/icons/comment.png" width="13px" style="margin-right:5px;" uk-tooltip="comentarios")
                                //- contamos los comentarios
                                -
                                    var contadorComentarios = 0
                                each empleado in proyecto.Project_Employees
                                    -
                                        contadorComentarios += empleado.Comments.length
                                div(class="uk-text-small" style="cursor: default") #{contadorComentarios}
            //- ESTE DIV ES LO MISMO QUE EL DE ARRIBA
            div()
                div(class="uk-card  uk-card-default")
                    div(class="uk-card-header uk-padding-remove uk-flex" style="background:rgba(253, 245, 52, 0.53);" /* va cambiando el background*/)
                        div(class="uk-width-3-5 uk-margin-small-left uk-margin-small-top uk-margin-small-bottom")
                            div(class="" style="color: #222238;") Nombre del proyecto
                            div(class="uk-text-small") Tipo de proyecto 1
                        div(class="uk-width-2-5 uk-flex uk-flex-right uk-flex-middle")
                            button(class="uk-margin-small-right" style="background: #86DDAE;border-radius:2px;color: #129326;border:none;padding:7px;font-size:8px;" /* CAMBIA EL COLOR DEL TEXTO Y BACKGROUND*/) EN TIEMPO
                    div(class="uk-card-body uk-padding-remove")
                        div(class="uk-width-1 uk-margin-small-top")
                            div(class="o-progress-date-line")
                            //- EL COLOR DE LAS BOLITAS DEBE IR CAMBIANDO
                            div(class="o-progress-date-start" style="background: #FDF534;")
                            div(class="o-progress-date-end" style="background: #FDF534;")
                            div(class="o-progress-date-today" uk-tooltip="06/01/2020" style="margin-left:70%; border: 1px solid #FDF534;" /*Aquí en el margin va el valor del avance, calcularlo de alguna forma, pero no debe pasar de 93% ni ser menos de 5%*/)
                            div(class="o-progress-date-dates")
                                div(class="uk-text-small") 27, DIC, 2020
                                div(class="uk-text-small") 04, MAR, 2021
                    div(class="uk-width-1 uk-flex uk-flex-wrap uk-margin-small-top")
                        div(class="uk-width-2-5")
                            div(class="progress--circle progress--99" style="" /*LOS VALORES DEBEN SER REDONDEADOS A MULTIPLOS DE 5, para el 100 porciento se ve mejor si se uusa unvalor diferente como por ejemplo 99*/)
                                div(class="progress__number") 100%
                        div(class="uk-width-3-5 uk-width-1@s uk-width-3-5")
                            div(class="uk-text-large" style="color: #222238;") 77
                            div(class="uk-text-small") Tareas / Documentos listos
                            div(class="uk-text-large" style="color: #222238;") 0
                            div(class="uk-text-small") Tareas / Documentos faltantes
                    div(class="uk-margin-top uk-margin-small-left uk-text-small") MIEMBROS DEL PROYECTO
                    div(class="uk-width-1 uk-flex uk-flex-wrap")
                        div(class="uk-width-2-3 uk-flex uk-flex-wrap uk-margin-bottom")
                            img(src="/img/prueba/perfil1.png" width="33px" class="uk-margin-small-left" style="border-radius:50%; height:33px;object-fit:cover;margin-top:10px;")
                            img(src="/img/prueba/perfil2.png" width="33px" class="uk-margin-small-left" style="border-radius:50%; height:33px;object-fit:cover;margin-top:10px;")
                            img(src="/img/prueba/perfil1.png" width="33px" class="uk-margin-small-left" style="border-radius:50%; height:33px;object-fit:cover;margin-top:10px;")
                            img(src="/img/prueba/perfil3.jpg" width="33px" class="uk-margin-small-left" style="border-radius:50%; height:33px;object-fit:cover;margin-top:10px;")
                        div(class="uk-width-1-3 uk-position-bottom-right uk-flex uk-flex-right uk-flex-middle uk-margin-small-right uk-margin-bottom")
                            img(src="/icons/archivo.png" width="13px" style="margin-right:5px;")
                            div(class="uk-text-small" style="margin-right:10px;") 20
                            img(src="/icons/comment.png" width="13px" style="margin-right:5px;")
                            div(class="uk-text-small") 5
         

